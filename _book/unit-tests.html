<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Team Programming for Scientists</title>
  <meta name="description" content="A short introduction to software engineering for scientists">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Team Programming for Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A short introduction to software engineering for scientists" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Team Programming for Scientists" />
  
  <meta name="twitter:description" content="A short introduction to software engineering for scientists" />
  

<meta name="author" content="Paweł Piątkowski">


<meta name="date" content="2018-09-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="coding-style-and-documentation.html">
<link rel="next" href="task-management.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="version-control-systems-git.html"><a href="version-control-systems-git.html"><i class="fa fa-check"></i><b>2</b> Version control systems: git</a><ul>
<li class="chapter" data-level="2.1" data-path="version-control-systems-git.html"><a href="version-control-systems-git.html#cloning-a-repository"><i class="fa fa-check"></i><b>2.1</b> Cloning a repository</a></li>
<li class="chapter" data-level="2.2" data-path="version-control-systems-git.html"><a href="version-control-systems-git.html#committing-changes"><i class="fa fa-check"></i><b>2.2</b> Committing changes</a></li>
<li class="chapter" data-level="2.3" data-path="version-control-systems-git.html"><a href="version-control-systems-git.html#working-on-branches"><i class="fa fa-check"></i><b>2.3</b> Working on branches</a></li>
<li class="chapter" data-level="2.4" data-path="version-control-systems-git.html"><a href="version-control-systems-git.html#pull-requests"><i class="fa fa-check"></i><b>2.4</b> Pull requests</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="writing-reusable-code.html"><a href="writing-reusable-code.html"><i class="fa fa-check"></i><b>3</b> Writing reusable code</a><ul>
<li class="chapter" data-level="3.1" data-path="writing-reusable-code.html"><a href="writing-reusable-code.html#r-packages"><i class="fa fa-check"></i><b>3.1</b> R packages</a></li>
<li class="chapter" data-level="3.2" data-path="writing-reusable-code.html"><a href="writing-reusable-code.html#good-practices"><i class="fa fa-check"></i><b>3.2</b> Good practices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="coding-style-and-documentation.html"><a href="coding-style-and-documentation.html"><i class="fa fa-check"></i><b>4</b> Coding style and documentation</a><ul>
<li class="chapter" data-level="4.1" data-path="coding-style-and-documentation.html"><a href="coding-style-and-documentation.html#coding-style"><i class="fa fa-check"></i><b>4.1</b> Coding style</a></li>
<li class="chapter" data-level="4.2" data-path="coding-style-and-documentation.html"><a href="coding-style-and-documentation.html#documentation"><i class="fa fa-check"></i><b>4.2</b> Documentation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="unit-tests.html"><a href="unit-tests.html"><i class="fa fa-check"></i><b>5</b> Unit tests</a><ul>
<li class="chapter" data-level="5.1" data-path="unit-tests.html"><a href="unit-tests.html#an-ideal-unit-test"><i class="fa fa-check"></i><b>5.1</b> An ideal unit test</a></li>
<li class="chapter" data-level="5.2" data-path="unit-tests.html"><a href="unit-tests.html#test-conditions"><i class="fa fa-check"></i><b>5.2</b> Test conditions</a></li>
<li class="chapter" data-level="5.3" data-path="unit-tests.html"><a href="unit-tests.html#test-driven-development"><i class="fa fa-check"></i><b>5.3</b> Test-Driven Development</a><ul>
<li class="chapter" data-level="5.3.1" data-path="unit-tests.html"><a href="unit-tests.html#hybrid-approach"><i class="fa fa-check"></i><b>5.3.1</b> “Hybrid” approach</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="unit-tests.html"><a href="unit-tests.html#unit-testing-in-r"><i class="fa fa-check"></i><b>5.4</b> Unit testing in R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="task-management.html"><a href="task-management.html"><i class="fa fa-check"></i><b>6</b> Task management</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Team Programming for Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unit-tests" class="section level1">
<h1><span class="header-section-number">5</span> Unit tests</h1>
<p>Unit tests are like seat belts: they seem to be only complicating your life – until an accident happens.</p>
<p>Imagine you’re writing a function that takes an input and returns some result. Unless your function performs trivial calculations, like a single mathematical operation, you need to check somehow if it’s well written. Typically, you would execute your function with several sets of input parameters and verify if the output is correct. Now imagine that you have dozens of functions in your project, some of them very sophisticated, and you decide to optimize the workflow. Or completely change the architecture of your program. What would you do? What comes to mind, is: try to automate it, writing a script that would execute your functions with a predefined set of input parameters each time it’s launched.</p>
<p>Now add automatic output validation and you get unit tests.</p>
<p>In a team setting, unit tests are important for one more reason: they can tell your peers or future developers <em>what</em> exactly you expect your function to do. Sometimes documentation is not enough when your function deals with complicated input.</p>
<p>Unit testing routines are available for most programming languages – usually as separate libraries. Basic procedure almost always looks roughly the same: a single <em>test case</em> consists of the execution of one function and the expected output.</p>
<div id="an-ideal-unit-test" class="section level2">
<h2><span class="header-section-number">5.1</span> An ideal unit test</h2>
<p>Ideally, unit tests should follow these rules:</p>
<ul>
<li>They should <strong>reflect the goal of the function</strong> – one should be able to infer what the function does by reading the test…</li>
<li>…but they <strong>can’t duplicate the logic of the function</strong> – if you share function’s code with the test, you may be sharing bugs as well.</li>
<li>They <strong>must not be changed after refactoring the function</strong> – this would undermine the point of unit testing.</li>
<li>They <strong>shouldn’t be redundant</strong> – a test for one unit of code should be written and executed only once.</li>
<li>They should <strong>cover the smallest possible portion of code</strong> (hence the name), usually one function – you shouldn’t confuse unit tests with <em>integration tests</em>, which check the cooperation of elements within the program.</li>
</ul>
<p>It’s hard to follow these rules to a T – sometimes the structure of your application makes it hard to split into easily testable functions, or these functions are so interdependent that they can’t be tested separately – but the more closely you’ll follow them, the more you’ll get from your tests.</p>
</div>
<div id="test-conditions" class="section level2">
<h2><span class="header-section-number">5.2</span> Test conditions</h2>
<p>One of the most important tasks when writing unit test is the proper design of testing conditions. Let’s consider a trivial example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">divide =<span class="st"> </span><span class="cf">function</span>(x, y) {
  x <span class="op">/</span><span class="st"> </span>y
}</code></pre></div>
<p>Now, you can test this functions for some made-up values of x and y [examples written using testthat package for R]:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">expect_equal</span>(<span class="kw">divide</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fl">0.5</span>)
<span class="kw">expect_equal</span>(<span class="kw">divide</span>(<span class="dv">10</span>, <span class="dv">5</span>), <span class="dv">2</span>)
<span class="co"># etc...</span></code></pre></div>
<p>but it makes little sense. Instead, you should think about some tricky cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">divide</span>(<span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># should it return Inf or throw an error?</span>
<span class="kw">divide</span>(<span class="fl">1e300</span>, <span class="fl">1e300</span>) <span class="co"># what about large numbers?</span>
<span class="kw">divide</span>(<span class="dv">5</span>, <span class="st">&quot;10&quot;</span>) <span class="co"># what if one of the arguments is not numeric?</span></code></pre></div>
<p>From this simple case you can see that designing test conditions makes you think about the intended behavior of your function and, sometimes, about the goal of writing it. Which leads us to the next point…</p>
</div>
<div id="test-driven-development" class="section level2">
<h2><span class="header-section-number">5.3</span> Test-Driven Development</h2>
<p>Test-driven development (abbreviated TDD) is a step forward in writing unit tests. Instead of writing tests for the existing code, you write them… before the tested functions are even created.</p>
<p>What’s the point of this? How is it even possible?</p>
<p>When you write a unit test for a non-existent function, you have to thoroughly think over its input and desired output (as we saw in the previous section), what the function should actually do and how it would interact with other parts of the program. Obviously the test will initially fail, because there’s no function yet, but when you eventually write it, it should behave exactly as intended by the test – and that’s the point of TDD: the program is ready when all tests pass.</p>
<p>I’m not advocating TDD – I hardly ever use it – but I strongly recommend following the philosophy of TDD: design your tests so that when a test fails, you refactor the tested function, not the test.</p>
<div id="hybrid-approach" class="section level3">
<h3><span class="header-section-number">5.3.1</span> “Hybrid” approach</h3>
<p>For some projects, especially from the scientific domain R is often used for, a mixed testing style would be a better choice:</p>
<ol style="list-style-type: decimal">
<li>“Mold” the initial version of the function – this is effectively a prototype of the new functionality.</li>
<li>Write an extensive set of unit tests, covering cases you haven’t thought about when writing your function.
<ol style="list-style-type: lower-alpha">
<li>If possible, ask your peers to think of some edge cases – this is a great exercise in team programming, complementing traditional code review.</li>
</ol></li>
<li>Adjust your code so that the tests don’t fail.</li>
<li>If you need to refactor the code, <em>don’t</em> change the tests. Let the new code pass the existing tests, and only then modify them.</li>
</ol>
</div>
</div>
<div id="unit-testing-in-r" class="section level2">
<h2><span class="header-section-number">5.4</span> Unit testing in R</h2>
<p>There are several packages for unit testing in R, RUnit and testthat being the most widely used. While the latter seems to be more popular and actively maintained, both are perfectly valid for writing unit tests and the choice of one over the other is up to your preference (or the guidelines for the project).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="coding-style-and-documentation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="task-management.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
